<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 진실성 탐지기 - 통합 버전</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .version-selector {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 2rem auto;
            max-width: 1000px;
        }
        
        .version-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            border-radius: 20px 20px 0 0;
        }
        
        .version-body {
            padding: 2rem;
        }
        
        .version-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: none;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .version-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .version-card-header {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }
        
        .version-card-body {
            padding: 1.5rem;
        }
        
        .enterprise-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 1rem;
        }
        
        .basic-badge {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 1rem;
        }
        
        .btn-select {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            padding: 1rem 2rem;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn-select:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list li i {
            color: #4ecdc4;
            margin-right: 0.5rem;
        }
        
        .analysis-interface {
            display: none;
        }
        
        .analysis-interface.show {
            display: block;
        }
        
        .loading {
            display: none;
        }
        
        .loading.show {
            display: block;
        }
        
        .truth-meter {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .truth-indicator {
            height: 100%;
            background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #28a745 100%);
            transition: width 0.3s ease;
        }
        
        .detector-card {
            transition: all 0.3s ease;
        }
        
        .detector-card:hover {
            transform: scale(1.02);
        }
    </style>
</head>
<body>
    <!-- 버전 선택 인터페이스 -->
    <div id="versionSelector" class="version-selector">
        <div class="version-header">
            <h1><i class="fas fa-robot"></i> AI 진실성 탐지기</h1>
            <p class="mb-0">사용할 버전을 선택해주세요</p>
        </div>
        
        <div class="version-body">
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="version-card h-100">
                        <div class="version-card-header">
                            <div class="basic-badge">
                                <i class="fas fa-star"></i> BASIC VERSION
                            </div>
                            <h3>Basic Version</h3>
                            <p class="mb-0">기본 AI 진실성 탐지 기능</p>
                        </div>
                        
                        <div class="version-card-body">
                            <h5><i class="fas fa-list"></i> 주요 기능</h5>
                            <ul class="feature-list">
                                <li><i class="fas fa-check"></i>기본 진실성 탐지</li>
                                <li><i class="fas fa-check"></i>AI 자체 분석</li>
                                <li><i class="fas fa-check"></i>웹 연구</li>
                                <li><i class="fas fa-check"></i>배치 분석</li>
                                <li><i class="fas fa-check"></i>간단한 UI</li>
                            </ul>
                            
                            <button class="btn btn-select" onclick="selectVersion('basic')">
                                <i class="fas fa-play"></i> Basic 버전 시작
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="version-card h-100">
                        <div class="version-card-header">
                            <div class="enterprise-badge">
                                <i class="fas fa-crown"></i> ENTERPRISE EDITION
                            </div>
                            <h3>Enterprise Edition</h3>
                            <p class="mb-0">엔터프라이즈급 고급 기능</p>
                        </div>
                        
                        <div class="version-card-body">
                            <h5><i class="fas fa-list"></i> 주요 기능</h5>
                            <ul class="feature-list">
                                <li><i class="fas fa-check"></i>45개 API 엔드포인트</li>
                                <li><i class="fas fa-check"></i>실시간 알림 시스템</li>
                                <li><i class="fas fa-check"></i>JWT 인증</li>
                                <li><i class="fas fa-check"></i>고급 분석 기능</li>
                                <li><i class="fas fa-check"></i>다국어 지원</li>
                                <li><i class="fas fa-check"></i>Docker 지원</li>
                            </ul>
                            
                            <button class="btn btn-select" onclick="selectVersion('enterprise')">
                                <i class="fas fa-play"></i> Enterprise 버전 시작
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 분석 인터페이스 (기본적으로 숨김) -->
    <div id="analysisInterface" class="analysis-interface">
        <div class="container-fluid py-4">
            <!-- 버전 표시 및 전환 버튼 -->
            <div class="row mb-3">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="text-white mb-0">
                                <i class="fas fa-robot me-2"></i>
                                AI 진실성 탐지기
                                <span id="currentVersionBadge" class="badge ms-2 fs-6"></span>
                            </h2>
                        </div>
                        <button class="btn btn-outline-light" onclick="showVersionSelector()">
                            <i class="fas fa-exchange-alt me-2"></i>버전 변경
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 분석 모드 선택 (Enterprise 버전만) -->
            <div id="analysisModeSelector" class="row mb-4" style="display: none;">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>분석 모드 선택</h5>
                            <small class="text-muted">아래에서 원하는 분석 모드를 선택해주세요</small>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 mb-2">
                                    <button class="btn btn-outline-primary w-100 analysis-mode-btn" data-mode="all">
                                        <i class="fas fa-layer-group me-2"></i>통합 분석
                                        <small class="d-block">모든 기능 사용</small>
                                    </button>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <button class="btn btn-outline-success w-100 analysis-mode-btn" data-mode="puns">
                                        <i class="fas fa-smile me-2"></i>말장난 분석
                                        <small class="d-block">언어적 유머 감지</small>
                                    </button>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <button class="btn btn-outline-warning w-100 analysis-mode-btn" data-mode="coding">
                                        <i class="fas fa-code me-2"></i>코딩 품질
                                        <small class="d-block">코드 품질 검증</small>
                                    </button>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <button class="btn btn-outline-info w-100 analysis-mode-btn" data-mode="multilingual">
                                        <i class="fas fa-globe me-2"></i>다국어 분석
                                        <small class="d-block">언어 혼합 감지</small>
                                    </button>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-4 mb-2">
                                    <button class="btn btn-outline-danger w-100 analysis-mode-btn" data-mode="ai-self">
                                        <i class="fas fa-robot me-2"></i>AI 자체 분석
                                        <small class="d-block">AI가 스스로 자신을 분석</small>
                                    </button>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <button class="btn btn-outline-warning w-100 analysis-mode-btn" data-mode="research">
                                        <i class="fas fa-search me-2"></i>웹 연구
                                        <small class="d-block">인터넷에서 정보 검색</small>
                                    </button>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <button class="btn btn-outline-success w-100 analysis-mode-btn" data-mode="verify">
                                        <i class="fas fa-check-double me-2"></i>사실 검증
                                        <small class="d-block">정보의 진실성 확인</small>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <!-- 분석 입력 섹션 -->
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-search me-2"></i>
                                AI 문장 분석
                            </h5>
                        </div>
                        <div class="card-body">
                            <form id="analysisForm">
                                <div class="mb-3">
                                    <label for="statement" class="form-label">분석할 문장을 입력하세요:</label>
                                    <textarea 
                                        class="form-control" 
                                        id="statement" 
                                        name="statement" 
                                        rows="4" 
                                        placeholder="예: 토끼는 동물이다."
                                        required
                                    ></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="context" class="form-label">추가 컨텍스트 (선택사항):</label>
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        id="context" 
                                        name="context" 
                                        placeholder="예: 과학적 사실에 대한 설명"
                                    >
                                </div>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-play me-2"></i>
                                    진실성 분석 시작
                                </button>
                            </form>
                            
                            <!-- 로딩 표시 -->
                            <div class="loading text-center mt-4">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">분석 중...</span>
                                </div>
                                <p class="mt-2 text-muted">문장을 분석하고 있습니다...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 분석 결과 섹션 -->
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-chart-pie me-2"></i>
                                분석 결과
                            </h5>
                        </div>
                        <div class="card-body" id="analysisResult">
                            <div class="text-center text-muted">
                                <i class="fas fa-info-circle fa-3x mb-3"></i>
                                <p>분석할 문장을 입력하고 "진실성 분석 시작" 버튼을 클릭하세요.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 최근 분석 결과 -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-history me-2"></i>
                                최근 분석 결과
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="recentAnalyses">
                                <div class="text-center text-muted">
                                    <i class="fas fa-clock fa-2x mb-2"></i>
                                    <p>아직 분석된 문장이 없습니다.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentVersion = null;
        let currentAnalysisMode = null;
        
        // 버전 선택 함수
        function selectVersion(version) {
            currentVersion = version;
            
            // 버전 배지 업데이트
            const badge = document.getElementById('currentVersionBadge');
            if (version === 'basic') {
                badge.textContent = 'Basic Version';
                badge.className = 'badge bg-info ms-2 fs-6';
                document.getElementById('analysisModeSelector').style.display = 'none';
            } else {
                badge.textContent = 'Enterprise Edition';
                badge.className = 'badge bg-warning text-dark ms-2 fs-6';
                document.getElementById('analysisModeSelector').style.display = 'block';
            }
            
            // 인터페이스 전환
            document.getElementById('versionSelector').style.display = 'none';
            document.getElementById('analysisInterface').classList.add('show');
            
            // 분석 모드 초기화
            currentAnalysisMode = null;
            document.querySelectorAll('.analysis-mode-btn').forEach(btn => {
                btn.classList.remove('active', 'btn-primary', 'btn-success', 'btn-warning', 'btn-info', 'btn-danger', 'btn-dark');
                btn.classList.add('btn-outline-primary', 'btn-outline-success', 'btn-outline-warning', 'btn-outline-info', 'btn-outline-danger', 'btn-outline-dark');
            });
        }
        
        // 버전 선택기 표시 함수
        function showVersionSelector() {
            document.getElementById('versionSelector').style.display = 'block';
            document.getElementById('analysisInterface').classList.remove('show');
            currentVersion = null;
            currentAnalysisMode = null;
        }
        
        // 분석 모드 선택 이벤트 리스너
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.analysis-mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // 모든 버튼에서 active 클래스 제거
                    document.querySelectorAll('.analysis-mode-btn').forEach(b => {
                        b.classList.remove('active', 'btn-primary', 'btn-success', 'btn-warning', 'btn-info', 'btn-danger', 'btn-dark');
                        b.classList.add('btn-outline-primary', 'btn-outline-success', 'btn-outline-warning', 'btn-outline-info', 'btn-outline-danger', 'btn-outline-dark');
                    });
                    
                    // 클릭된 버튼에 active 클래스 추가 및 색상 변경
                    this.classList.add('active');
                    this.classList.remove('btn-outline-primary', 'btn-outline-success', 'btn-outline-warning', 'btn-outline-info', 'btn-outline-danger', 'btn-outline-dark');
                    
                    // 모드에 따른 색상 적용
                    const mode = this.dataset.mode;
                    if (mode === 'all') {
                        this.classList.add('btn-primary');
                    } else if (mode === 'puns') {
                        this.classList.add('btn-success');
                    } else if (mode === 'coding') {
                        this.classList.add('btn-warning');
                    } else if (mode === 'multilingual') {
                        this.classList.add('btn-info');
                    } else if (mode === 'ai-self') {
                        this.classList.add('btn-danger');
                    } else if (mode === 'research') {
                        this.classList.add('btn-primary');
                    } else if (mode === 'verify') {
                        this.classList.add('btn-success');
                    }
                    
                    // 분석 모드 업데이트
                    currentAnalysisMode = mode;
                });
            });
            
            // 폼 제출 처리
            document.getElementById('analysisForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const statement = document.getElementById('statement').value.trim();
                const context = document.getElementById('context').value.trim();
                
                if (!statement) {
                    alert('분석할 문장을 입력해주세요.');
                    return;
                }
                
                if (currentVersion === 'enterprise' && !currentAnalysisMode) {
                    alert('분석 모드를 선택해주세요.');
                    return;
                }
                
                // 로딩 표시
                document.querySelector('.loading').classList.add('show');
                document.getElementById('analysisResult').innerHTML = '';
                
                try {
                    let endpoint, requestBody;
                    
                    if (currentVersion === 'basic') {
                        // 기본 버전 API
                        endpoint = '/analyze';
                        requestBody = {
                            sentence: statement,
                            context: context
                        };
                    } else {
                        // 엔터프라이즈 버전 API
                        if (currentAnalysisMode === 'ai-self') {
                            endpoint = '/api/ai-self-analysis';
                            requestBody = {
                                statement: statement,
                                context: context,
                                ai_self_analysis: true
                            };
                        } else if (currentAnalysisMode === 'research') {
                            endpoint = '/api/research-question';
                            requestBody = {
                                question: statement,
                                type: 'advanced'
                            };
                        } else if (currentAnalysisMode === 'verify') {
                            endpoint = '/api/verify-fact';
                            requestBody = {
                                statement: statement
                            };
                        } else {
                            endpoint = currentAnalysisMode === 'all' ? '/analyze' : `/analyze/${currentAnalysisMode}`;
                            requestBody = {
                                statement: statement,
                                context: context
                            };
                        }
                    }
                    
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        if (currentAnalysisMode === 'research') {
                            displayResearchResult(data.research_result);
                        } else if (currentAnalysisMode === 'verify') {
                            displayVerificationResult(data.verification_result);
                        } else {
                            displayAnalysisResult(data.analysis || data);
                        }
                        loadRecentAnalyses();
                    } else {
                        throw new Error(data.message || '분석 중 오류가 발생했습니다.');
                    }
                } catch (error) {
                    document.getElementById('analysisResult').innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            ${error.message}
                        </div>
                    `;
                } finally {
                    document.querySelector('.loading').classList.remove('show');
                }
            });
        });
        
        // 분석 결과 표시 함수
        function displayAnalysisResult(analysis) {
            const resultDiv = document.getElementById('analysisResult');
            
            if (currentVersion === 'basic') {
                // 기본 버전 결과 표시
                const truthScore = analysis.truth_score;
                const confidence = analysis.confidence;
                
                let resultHtml = `
                    <div class="mb-3">
                        <h6>진실성 점수</h6>
                        <div class="truth-meter mb-2">
                            <div class="truth-indicator" style="width: ${truthScore * 100}%"></div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="badge bg-${truthScore >= 0.8 ? 'success' : truthScore >= 0.5 ? 'warning' : 'danger'} fs-6">
                                ${(truthScore * 100).toFixed(1)}%
                            </span>
                            <small class="text-muted">신뢰도: ${(confidence * 100).toFixed(1)}%</small>
                        </div>
                    </div>
                `;
                
                if (analysis.ai_analysis) {
                    resultHtml += `
                        <div class="mb-3">
                            <h6>AI 자체 분석</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check"></i>자기 인식: ${analysis.ai_analysis.self_awareness ? '감지됨' : '감지되지 않음'}</li>
                                <li><i class="fas fa-check"></i>불확실성: ${analysis.ai_analysis.uncertainty_detected ? '감지됨' : '감지되지 않음'}</li>
                            </ul>
                        </div>
                    `;
                }
                
                if (analysis.web_research && analysis.web_research.results_count > 0) {
                    resultHtml += `
                        <div class="mb-3">
                            <h6>웹 연구 결과 (${analysis.web_research.results_count}개)</h6>
                            ${analysis.web_research.results.slice(0, 3).map(result => `
                                <div class="card mb-2">
                                    <div class="card-body p-2">
                                        <h6 class="card-title">${result.title}</h6>
                                        <p class="card-text small">${result.snippet}</p>
                                        <small class="text-muted">신뢰도: ${(result.credibility_score * 100).toFixed(1)}%</small>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                resultDiv.innerHTML = resultHtml;
            } else {
                // 엔터프라이즈 버전 결과 표시
                const finalAnalysis = analysis.final_analysis || analysis;
                const truthPercentage = (finalAnalysis.truth_percentage * 100).toFixed(1);
                const confidence = (finalAnalysis.confidence * 100).toFixed(1);
                
                let resultHtml = `
                    <div class="mb-3">
                        <h6>통합 진실성 점수</h6>
                        <div class="truth-meter mb-2">
                            <div class="truth-indicator" style="width: ${truthPercentage}%"></div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="badge bg-${truthPercentage >= 99 ? 'success' : truthPercentage >= 70 ? 'warning' : 'danger'} fs-6">
                                ${truthPercentage}%
                            </span>
                            <small class="text-muted">신뢰도: ${confidence}%</small>
                        </div>
                    </div>
                `;
                
                // 탐지기별 결과 표시
                if (analysis.meta_analysis) {
                    resultHtml += `
                        <div class="mb-3">
                            <h6>탐지기별 분석 결과</h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="card detector-card border-${analysis.meta_analysis.meta_lie_detected ? 'danger' : 'success'}">
                                        <div class="card-body p-2">
                                            <small class="fw-bold">메타-진실성</small>
                                            <div class="text-${analysis.meta_analysis.meta_lie_detected ? 'danger' : 'success'}">
                                                <i class="fas fa-${analysis.meta_analysis.meta_lie_detected ? 'times' : 'check'}"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="card detector-card border-${analysis.scientific_analysis?.scientific_lie_detected ? 'danger' : 'success'}">
                                        <div class="card-body p-2">
                                            <small class="fw-bold">과학적 검증</small>
                                            <div class="text-${analysis.scientific_analysis?.scientific_lie_detected ? 'danger' : 'success'}">
                                                <i class="fas fa-${analysis.scientific_analysis?.scientific_lie_detected ? 'times' : 'check'}"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                resultDiv.innerHTML = resultHtml;
            }
        }
        
        // 웹 연구 결과 표시 함수
        function displayResearchResult(result) {
            const resultDiv = document.getElementById('analysisResult');
            
            let html = `
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-search me-2"></i>웹 연구 결과</h5>
                    </div>
                    <div class="card-body">
                        <h6><i class="fas fa-question-circle me-2"></i>질문</h6>
                        <p class="border p-3 bg-light rounded">${result.question}</p>
                        
                        <h6><i class="fas fa-lightbulb me-2"></i>답변</h6>
                        <div class="border p-3 bg-success text-white rounded">
                            <pre style="white-space: pre-wrap; margin: 0;">${result.answer}</pre>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <h6><i class="fas fa-tachometer-alt me-2"></i>신뢰도</h6>
                                <div class="progress mb-3" style="height: 25px;">
                                    <div class="progress-bar ${result.confidence >= 0.8 ? 'bg-success' : result.confidence >= 0.6 ? 'bg-warning' : 'bg-danger'}" 
                                         style="width: ${result.confidence * 100}%">
                                        ${(result.confidence * 100).toFixed(1)}%
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-database me-2"></i>참고 소스</h6>
                                <span class="badge bg-info fs-6">${result.sources.length}개</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            resultDiv.innerHTML = html;
        }
        
        // 사실 검증 결과 표시 함수
        function displayVerificationResult(result) {
            const resultDiv = document.getElementById('analysisResult');
            
            let html = `
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-check-double me-2"></i>사실 검증 결과</h5>
                    </div>
                    <div class="card-body">
                        <h6><i class="fas fa-quote-left me-2"></i>검증 대상 문장</h6>
                        <p class="border p-3 bg-light rounded">${result.statement}</p>
                        
                        <div class="text-center">
                            <i class="fas fa-${result.is_verified ? 'check-circle text-success' : 'times-circle text-danger'} fa-3x mb-3"></i>
                            <h4 class="${result.is_verified ? 'text-success' : 'text-danger'}">
                                ${result.is_verified ? '사실로 확인됨' : '사실이 아닐 가능성'}
                            </h4>
                        </div>
                        
                        <div class="progress mb-3" style="height: 25px;">
                            <div class="progress-bar ${result.confidence >= 0.8 ? 'bg-success' : result.confidence >= 0.6 ? 'bg-warning' : 'bg-danger'}" 
                                 style="width: ${result.confidence * 100}%">
                                ${(result.confidence * 100).toFixed(1)}%
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            resultDiv.innerHTML = html;
        }
        
        // 최근 분석 결과 로드
        async function loadRecentAnalyses() {
            try {
                const response = await fetch('/api/recent_analyses');
                const analyses = await response.json();
                
                const recentDiv = document.getElementById('recentAnalyses');
                
                if (analyses.length === 0) {
                    recentDiv.innerHTML = `
                        <div class="text-center text-muted">
                            <i class="fas fa-clock fa-2x mb-2"></i>
                            <p>아직 분석된 문장이 없습니다.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                analyses.forEach(analysis => {
                    const finalAnalysis = analysis.final_analysis || analysis;
                    const truthPercentage = (finalAnalysis.truth_percentage * 100).toFixed(1);
                    const timestamp = new Date(analysis.timestamp).toLocaleString('ko-KR');
                    
                    html += `
                        <div class="border-bottom pb-3 mb-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <span class="badge bg-${truthPercentage >= 99 ? 'success' : truthPercentage >= 70 ? 'warning' : 'danger'} me-2">
                                        ${truthPercentage}%
                                    </span>
                                </div>
                                <small class="text-muted">${timestamp}</small>
                            </div>
                            <p class="mb-1">${analysis.statement}</p>
                            ${finalAnalysis.needs_correction ? '<small class="text-warning"><i class="fas fa-exclamation-triangle me-1"></i>교정 필요</small>' : '<small class="text-success"><i class="fas fa-check me-1"></i>진실성 확인</small>'}
                        </div>
                    `;
                });
                
                recentDiv.innerHTML = html;
            } catch (error) {
                console.error('최근 분석 결과 로드 실패:', error);
            }
        }
    </script>
</body>
</html>
