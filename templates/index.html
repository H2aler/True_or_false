{% extends "base.html" %}

{% block title %}AI ì§„ì‹¤ì„± íƒì§€ê¸° - í™ˆ{% endblock %}
<!-- Updated: 2025-01-09 -->

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="text-center mb-5">
            <h1 class="display-4 fw-bold text-primary mb-3">
                <i class="fas fa-shield-alt me-3"></i>
                AI ì§„ì‹¤ì„± íƒì§€ê¸°
            </h1>
            <p class="lead text-muted">
                AIê°€ ê±°ì§“ë§ì„ í•˜ëŠ”ì§€ ì¸¡ì •í•˜ê³ , 1% ì´ìƒ ê±°ì§“ë§ì„ ê°ì§€í•˜ë©´ ìë™ìœ¼ë¡œ êµì •í•©ë‹ˆë‹¤
            </p>
        </div>
    </div>
</div>

<!-- ê¸°ëŠ¥ ì„ íƒ ì„¹ì…˜ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>ë¶„ì„ ëª¨ë“œ ì„ íƒ</h5>
                <small class="text-muted">ì•„ë˜ì—ì„œ ì›í•˜ëŠ” ë¶„ì„ ëª¨ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</small>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-primary w-100 analysis-mode-btn" data-mode="all">
                            <i class="fas fa-layer-group me-2"></i>í†µí•© ë¶„ì„
                            <small class="d-block">ëª¨ë“  ê¸°ëŠ¥ ì‚¬ìš©</small>
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-success w-100 analysis-mode-btn" data-mode="puns">
                            <i class="fas fa-smile me-2"></i>ë§ì¥ë‚œ ë¶„ì„
                            <small class="d-block">ì–¸ì–´ì  ìœ ë¨¸ ê°ì§€</small>
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-warning w-100 analysis-mode-btn" data-mode="coding">
                            <i class="fas fa-code me-2"></i>ì½”ë”© í’ˆì§ˆ
                            <small class="d-block">ì½”ë“œ í’ˆì§ˆ ê²€ì¦</small>
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-info w-100 analysis-mode-btn" data-mode="multilingual">
                            <i class="fas fa-globe me-2"></i>ë‹¤êµ­ì–´ ë¶„ì„
                            <small class="d-block">ì–¸ì–´ í˜¼í•© ê°ì§€</small>
                        </button>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-danger w-100 analysis-mode-btn" data-mode="ai-self">
                            <i class="fas fa-robot me-2"></i>AI ìì²´ ë¶„ì„
                            <small class="d-block">AIê°€ ìŠ¤ìŠ¤ë¡œ ìì‹ ì„ ë¶„ì„</small>
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-warning w-100 analysis-mode-btn" data-mode="real-time">
                            <i class="fas fa-clock me-2"></i>ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
                            <small class="d-block">ì‹¤ì‹œê°„ ê±°ì§“ë§ ê°ì§€</small>
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-dark w-100 analysis-mode-btn" data-mode="meta">
                            <i class="fas fa-brain me-2"></i>ë©”íƒ€-ì¸ì§€ ë¶„ì„
                            <small class="d-block">AIì˜ ìê¸° ì¸ì‹</small>
                        </button>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6 mb-2">
                        <button class="btn btn-outline-primary w-100 analysis-mode-btn" data-mode="research">
                            <i class="fas fa-search me-2"></i>ì›¹ ì—°êµ¬
                            <small class="d-block">ì¸í„°ë„·ì—ì„œ ì •ë³´ ê²€ìƒ‰</small>
                        </button>
                    </div>
                    <div class="col-md-6 mb-2">
                        <button class="btn btn-outline-info w-100 analysis-mode-btn" data-mode="enhanced-research">
                            <i class="fas fa-search-plus me-2"></i>í–¥ìƒëœ ì›¹ ì—°êµ¬
                            <small class="d-block">ì‹¤ì‹œê°„ ê²€ìƒ‰ ê³¼ì • í‘œì‹œ</small>
                        </button>
                    </div>
                    <div class="col-md-6 mb-2">
                        <button class="btn btn-outline-success w-100 analysis-mode-btn" data-mode="verify">
                            <i class="fas fa-check-double me-2"></i>ì‚¬ì‹¤ ê²€ì¦
                            <small class="d-block">ì •ë³´ì˜ ì§„ì‹¤ì„± í™•ì¸</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- ë¶„ì„ ì…ë ¥ ì„¹ì…˜ -->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-search me-2"></i>
                    AI ë¬¸ì¥ ë¶„ì„
                </h5>
            </div>
            <div class="card-body">
                <form id="analysisForm">
                    <div class="mb-3">
                        <label for="statement" class="form-label">ë¶„ì„í•  ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
                        <textarea 
                            class="form-control" 
                            id="statement" 
                            name="statement" 
                            rows="4" 
                            placeholder="ì˜ˆ: ì§€êµ¬ëŠ” ì™„ì „íˆ ë‘¥ê¸€ê³  ëª¨ë“  ì‚¬ëŒì´ ì´ë¥¼ ì•Œê³  ìˆë‹¤."
                            required
                        ></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="context" class="form-label">ì¶”ê°€ ì»¨í…ìŠ¤íŠ¸ (ì„ íƒì‚¬í•­):</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="context" 
                            name="context" 
                            placeholder="ì˜ˆ: ê³¼í•™ì  ì‚¬ì‹¤ì— ëŒ€í•œ ì„¤ëª…"
                        >
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-play me-2"></i>
                        ì§„ì‹¤ì„± ë¶„ì„ ì‹œì‘
                    </button>
                </form>
                
                <!-- ë¡œë”© í‘œì‹œ -->
                <div class="loading text-center mt-4">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">ë¶„ì„ ì¤‘...</span>
                    </div>
                    <p class="mt-2 text-muted">AIì˜ ì§„ì‹¤ì„±ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ë¶„ì„ ê²°ê³¼ ì„¹ì…˜ -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="fas fa-chart-pie me-2"></i>
                    ë¶„ì„ ê²°ê³¼
                </h5>
            </div>
            <div class="card-body" id="analysisResult">
                <div class="text-center text-muted">
                    <i class="fas fa-info-circle fa-3x mb-3"></i>
                    <p>ë¶„ì„í•  ë¬¸ì¥ì„ ì…ë ¥í•˜ê³  "ì§„ì‹¤ì„± ë¶„ì„ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ìµœê·¼ ë¶„ì„ ê²°ê³¼ -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-history me-2"></i>
                    ìµœê·¼ ë¶„ì„ ê²°ê³¼
                </h5>
            </div>
            <div class="card-body">
                <div id="recentAnalyses">
                    <div class="text-center text-muted">
                        <i class="fas fa-clock fa-2x mb-2"></i>
                        <p>ì•„ì§ ë¶„ì„ëœ ë¬¸ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<style>
/* íƒ€ì„ë¼ì¸ ìŠ¤íƒ€ì¼ */
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 15px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #dee2e6;
}

.timeline-item {
    position: relative;
    margin-bottom: 20px;
}

.timeline-marker {
    position: absolute;
    left: -22px;
    top: 5px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 0 0 2px #dee2e6;
}

.timeline-content {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border-left: 3px solid #007bff;
}

.timeline-title {
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 600;
}

.timeline-description {
    margin-bottom: 5px;
    font-size: 13px;
    color: #6c757d;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('analysisForm');
    const loading = document.querySelector('.loading');
    const resultDiv = document.getElementById('analysisResult');
    const recentDiv = document.getElementById('recentAnalyses');
    
    // ë¶„ì„ ëª¨ë“œ ë³€ìˆ˜
    let currentAnalysisMode = null; // ê¸°ë³¸ê°’: ì„ íƒë˜ì§€ ì•ŠìŒ
    
    // ë¶„ì„ ëª¨ë“œ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.querySelectorAll('.analysis-mode-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // ëª¨ë“  ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.analysis-mode-btn').forEach(b => {
                b.classList.remove('active', 'btn-primary', 'btn-success', 'btn-warning', 'btn-info', 'btn-danger', 'btn-dark');
                b.classList.add('btn-outline-primary', 'btn-outline-success', 'btn-outline-warning', 'btn-outline-info', 'btn-outline-danger', 'btn-outline-dark');
            });
            
            // í´ë¦­ëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€ ë° ìƒ‰ìƒ ë³€ê²½
            this.classList.add('active');
            this.classList.remove('btn-outline-primary', 'btn-outline-success', 'btn-outline-warning', 'btn-outline-info', 'btn-outline-danger', 'btn-outline-dark');
            
            // ëª¨ë“œì— ë”°ë¥¸ ìƒ‰ìƒ ì ìš©
            const mode = this.dataset.mode;
            if (mode === 'all') {
                this.classList.add('btn-primary');
            } else if (mode === 'puns') {
                this.classList.add('btn-success');
            } else if (mode === 'coding') {
                this.classList.add('btn-warning');
            } else if (mode === 'multilingual') {
                this.classList.add('btn-info');
            } else if (mode === 'ai-self') {
                this.classList.add('btn-danger');
            } else if (mode === 'real-time') {
                this.classList.add('btn-warning');
            } else if (mode === 'meta') {
                this.classList.add('btn-dark');
            } else if (mode === 'research') {
                this.classList.add('btn-primary');
            } else if (mode === 'verify') {
                this.classList.add('btn-success');
            }
            
            // ë¶„ì„ ëª¨ë“œ ì—…ë°ì´íŠ¸
            currentAnalysisMode = mode;
            
            // ëª¨ë“œì— ë”°ë¥¸ ì„¤ëª… ì—…ë°ì´íŠ¸
            updateModeDescription();
            
            // ì„ íƒ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
            showSelectionFeedback(mode);
        });
    });
    
    // ëª¨ë“œ ì„¤ëª… ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateModeDescription() {
        const descriptions = {
            'all': 'ëª¨ë“  ë¶„ì„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì¢…í•©ì ìœ¼ë¡œ ë¬¸ì¥ì„ ë¶„ì„í•©ë‹ˆë‹¤.',
            'puns': 'ì–¸ì–´ì  ìœ ë¨¸ì™€ ë§ì¥ë‚œì„ ê°ì§€í•˜ê³  ì´í•´í•©ë‹ˆë‹¤.',
            'coding': 'ì½”ë”© í’ˆì§ˆê³¼ ì˜ë„ì  ì¡°ì‘ì„ ë¶„ì„í•©ë‹ˆë‹¤.',
            'multilingual': 'ë‹¤êµ­ì–´ ë¬¸ì¥ì„ ë¶„ì„í•˜ê³  ì–¸ì–´ë³„ ì˜ë¯¸ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.',
            'ai-self': 'AIê°€ ìŠ¤ìŠ¤ë¡œ ìì‹ ì˜ ì¶œë ¥ì„ ë¶„ì„í•˜ì—¬ ê±°ì§“ë§ì„ ê°ì§€í•˜ê³  êµì •í•©ë‹ˆë‹¤.',
            'real-time': 'ì‹¤ì‹œê°„ìœ¼ë¡œ AIì˜ ì¶œë ¥ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ì¦‰ì‹œ êµì •í•©ë‹ˆë‹¤.',
            'meta': 'AIì˜ ë©”íƒ€-ì¸ì§€ ëŠ¥ë ¥ì„ í™œìš©í•œ ê³ ê¸‰ ì§„ì‹¤ì„± íƒì§€ì™€ ìê¸° ì„±ì°°ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.',
            'research': 'ì¸í„°ë„·ì—ì„œ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê³  ì‹ ë¢°ì„±ì„ í‰ê°€í•˜ì—¬ ì§ˆë¬¸ì— ë‹µë³€í•©ë‹ˆë‹¤.',
            'enhanced-research': 'ì‹¤ì‹œê°„ ê²€ìƒ‰ ê³¼ì •ì„ í‘œì‹œí•˜ë©° ì¸í„°ë„·ì—ì„œ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê³  ë‹µë³€í•©ë‹ˆë‹¤.',
            'verify': 'ì£¼ì–´ì§„ ë¬¸ì¥ì˜ ì‚¬ì‹¤ì„±ì„ ê²€ì¦í•˜ê³  ì¦ê±°ë¥¼ ì œì‹œí•©ë‹ˆë‹¤.'
        };
        
        const descriptionElement = document.querySelector('.lead.text-muted');
        if (descriptionElement) {
            descriptionElement.textContent = descriptions[currentAnalysisMode];
        }
    }
    
    // ì„ íƒ í”¼ë“œë°± í‘œì‹œ í•¨ìˆ˜
    function showSelectionFeedback(mode) {
        const modeNames = {
            'all': 'í†µí•© ë¶„ì„',
            'puns': 'ë§ì¥ë‚œ ë¶„ì„',
            'coding': 'ì½”ë”© í’ˆì§ˆ ë¶„ì„',
            'multilingual': 'ë‹¤êµ­ì–´ ë¶„ì„',
            'ai-self': 'AI ìì²´ ë¶„ì„',
            'real-time': 'ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§',
            'meta': 'ë©”íƒ€-ì¸ì§€ ë¶„ì„',
            'research': 'ì›¹ ì—°êµ¬',
            'enhanced-research': 'í–¥ìƒëœ ì›¹ ì—°êµ¬',
            'verify': 'ì‚¬ì‹¤ ê²€ì¦'
        };
        
        // ê¸°ì¡´ í”¼ë“œë°± ì œê±°
        const existingFeedback = document.querySelector('.selection-feedback');
        if (existingFeedback) {
            existingFeedback.remove();
        }
        
        // ìƒˆë¡œìš´ í”¼ë“œë°± ìƒì„±
        const feedback = document.createElement('div');
        feedback.className = 'selection-feedback alert alert-success alert-dismissible fade show mt-2';
        feedback.innerHTML = `
            <i class="fas fa-check-circle me-2"></i>
            <strong>${modeNames[mode]}</strong> ëª¨ë“œê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë¬¸ì¥ì„ ì…ë ¥í•˜ê³  ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”!
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        // ë¶„ì„ ëª¨ë“œ ì„ íƒ ì¹´ë“œì— ì¶”ê°€
        const cardBody = document.querySelector('.card-body');
        cardBody.appendChild(feedback);
        
        // 3ì´ˆ í›„ ìë™ ì œê±°
        setTimeout(() => {
            if (feedback.parentNode) {
                feedback.remove();
            }
        }, 3000);
    }
    
    // ëª¨ë“œ ì„ íƒ ê²½ê³  í‘œì‹œ í•¨ìˆ˜
    function showModeSelectionWarning() {
        // ê¸°ì¡´ ê²½ê³  ì œê±°
        const existingWarning = document.querySelector('.mode-selection-warning');
        if (existingWarning) {
            existingWarning.remove();
        }
        
        // ìƒˆë¡œìš´ ê²½ê³  ìƒì„±
        const warning = document.createElement('div');
        warning.className = 'mode-selection-warning alert alert-warning alert-dismissible fade show mt-2';
        warning.innerHTML = `
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>ë¶„ì„ ëª¨ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!</strong> ìœ„ì—ì„œ ì›í•˜ëŠ” ë¶„ì„ ëª¨ë“œë¥¼ í´ë¦­í•œ í›„ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”.
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        // ë¶„ì„ ëª¨ë“œ ì„ íƒ ì¹´ë“œì— ì¶”ê°€
        const cardBody = document.querySelector('.card-body');
        cardBody.appendChild(warning);
        
        // 5ì´ˆ í›„ ìë™ ì œê±°
        setTimeout(() => {
            if (warning.parentNode) {
                warning.remove();
            }
        }, 5000);
    }
    
    // í¼ ì œì¶œ ì²˜ë¦¬
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const statement = document.getElementById('statement').value.trim();
        const context = document.getElementById('context').value.trim();
        
        if (!statement) {
            alert('ë¶„ì„í•  ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        
        if (!currentAnalysisMode) {
            // ë¶„ì„ ëª¨ë“œ ì„ íƒ ì¹´ë“œì— ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
            showModeSelectionWarning();
            return;
        }
        
        // ë¡œë”© í‘œì‹œ
        loading.classList.add('show');
        resultDiv.innerHTML = '';
        
        try {
            // ì„ íƒëœ ëª¨ë“œì— ë”°ë¼ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
            let endpoint, requestBody;
            
            if (currentAnalysisMode === 'ai-self' || currentAnalysisMode === 'real-time' || currentAnalysisMode === 'meta') {
                // AI ìì²´ ë¶„ì„ ëª¨ë“œë“¤
                endpoint = '/api/ai-self-analysis';
                requestBody = {
                    statement: statement,
                    context: context,
                    ai_self_analysis: true
                };
            } else if (currentAnalysisMode === 'research') {
                // ì›¹ ì—°êµ¬ ëª¨ë“œ
                endpoint = '/api/research-question';
                requestBody = {
                    question: statement,
                    type: 'advanced'
                };
            } else if (currentAnalysisMode === 'enhanced-research') {
                // í–¥ìƒëœ ì›¹ ì—°êµ¬ ëª¨ë“œ
                endpoint = '/api/research-question';
                requestBody = {
                    question: statement,
                    type: 'enhanced'
                };
            } else if (currentAnalysisMode === 'verify') {
                // ì‚¬ì‹¤ ê²€ì¦ ëª¨ë“œ
                endpoint = '/api/verify-fact';
                requestBody = {
                    statement: statement
                };
            } else {
                // ê¸°ì¡´ ëª¨ë“œë“¤
                endpoint = currentAnalysisMode === 'all' ? '/analyze' : `/analyze/${currentAnalysisMode}`;
                requestBody = {
                    statement: statement,
                    context: context
                };
            }
            
            const response = await fetch(endpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });
            
            const data = await response.json();
            
            if (data.success) {
                if (currentAnalysisMode === 'research' || currentAnalysisMode === 'enhanced-research') {
                    displayResearchResult(data.research_result);
                } else if (currentAnalysisMode === 'verify') {
                    displayVerificationResult(data.verification_result);
                } else {
                    displayAnalysisResult(data.analysis);
                }
                loadRecentAnalyses();
            } else {
                throw new Error(data.error || 'ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        } catch (error) {
            resultDiv.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    ${error.message}
                </div>
            `;
        } finally {
            loading.classList.remove('show');
        }
    });
    
    // í†µí•© ë¶„ì„ ê²°ê³¼ í‘œì‹œ
    function displayAnalysisResult(analysis) {
        // AI ìì²´ ë¶„ì„ ê²°ê³¼ì¸ì§€ í™•ì¸
        if (analysis.analysis_type === 'ai_self_analysis') {
            displayAISelfAnalysisResult(analysis);
            return;
        }
        
        const finalAnalysis = analysis.final_analysis;
        const truthPercentage = (finalAnalysis.truth_percentage * 100).toFixed(1);
        const confidence = (finalAnalysis.confidence * 100).toFixed(1);
        
        let resultHtml = `
            <div class="mb-3">
                <h6>í†µí•© ì§„ì‹¤ì„± ì ìˆ˜</h6>
                <div class="truth-meter mb-2">
                    <div class="truth-indicator" style="width: ${truthPercentage}%"></div>
                </div>
                <div class="d-flex justify-content-between">
                    <span class="badge bg-${truthPercentage >= 99 ? 'success' : truthPercentage >= 70 ? 'warning' : 'danger'} fs-6">
                        ${truthPercentage}%
                    </span>
                    <small class="text-muted">ì‹ ë¢°ë„: ${confidence}%</small>
                </div>
            </div>
        `;
        
        // íƒì§€ê¸°ë³„ ê²°ê³¼ í‘œì‹œ
        resultHtml += `
            <div class="mb-3">
                <h6>íƒì§€ê¸°ë³„ ë¶„ì„ ê²°ê³¼</h6>
                <div class="row g-2">
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.meta_analysis.meta_lie_detected ? 'danger' : 'success'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ë©”íƒ€-ì§„ì‹¤ì„±</small>
                                <div class="text-${analysis.meta_analysis.meta_lie_detected ? 'danger' : 'success'}">
                                    <i class="fas fa-${analysis.meta_analysis.meta_lie_detected ? 'times' : 'check'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.religious_analysis.religious_topic_detected ? 'warning' : 'secondary'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ì¢…êµì  ë§¥ë½</small>
                                <div class="text-${analysis.religious_analysis.religious_topic_detected ? 'warning' : 'secondary'}">
                                    <i class="fas fa-${analysis.religious_analysis.religious_topic_detected ? 'exclamation-triangle' : 'minus'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.scientific_analysis.scientific_lie_detected ? 'danger' : 'success'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ê³¼í•™ì  ê²€ì¦</small>
                                <div class="text-${analysis.scientific_analysis.scientific_lie_detected ? 'danger' : 'success'}">
                                    <i class="fas fa-${analysis.scientific_analysis.scientific_lie_detected ? 'times' : 'check'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.intentional_analysis.intentional_lie_detected ? 'warning' : 'secondary'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ì˜ë„ì  ê±°ì§“ë§</small>
                                <div class="text-${analysis.intentional_analysis.intentional_lie_detected ? 'warning' : 'secondary'}">
                                    <i class="fas fa-${analysis.intentional_analysis.intentional_lie_detected ? 'exclamation-triangle' : 'minus'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.human_behavior_analysis.is_human_behavior_lie ? 'danger' : 'success'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ì¸ê°„ í–‰ë™</small>
                                <div class="text-${analysis.human_behavior_analysis.is_human_behavior_lie ? 'danger' : 'success'}">
                                    <i class="fas fa-${analysis.human_behavior_analysis.is_human_behavior_lie ? 'times' : 'check'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.benevolent_analysis.is_benevolent_lie ? 'info' : 'secondary'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ì„ ì˜ì˜ ê±°ì§“ë§</small>
                                <div class="text-${analysis.benevolent_analysis.is_benevolent_lie ? 'info' : 'secondary'}">
                                    <i class="fas fa-${analysis.benevolent_analysis.is_benevolent_lie ? 'heart' : 'minus'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.context_analysis.context_correction_applied ? 'primary' : 'secondary'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ë§¥ë½ ì¸ì‹</small>
                                <div class="text-${analysis.context_analysis.context_correction_applied ? 'primary' : 'secondary'}">
                                    <i class="fas fa-${analysis.context_analysis.context_correction_applied ? 'language' : 'minus'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.compound_analysis.compound_correction_applied ? 'dark' : 'secondary'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ë³µí•© ë¬¸ì¥</small>
                                <div class="text-${analysis.compound_analysis.compound_correction_applied ? 'dark' : 'secondary'}">
                                    <i class="fas fa-${analysis.compound_analysis.compound_correction_applied ? 'layer-group' : 'minus'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.puns_analysis.is_pun_detected ? 'success' : 'secondary'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ë§ì¥ë‚œ</small>
                                <div class="text-${analysis.puns_analysis.is_pun_detected ? 'success' : 'secondary'}">
                                    <i class="fas fa-${analysis.puns_analysis.is_pun_detected ? 'smile' : 'minus'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.coding_analysis.unnecessary_code_detected ? 'warning' : 'secondary'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ì½”ë”© í’ˆì§ˆ</small>
                                <div class="text-${analysis.coding_analysis.unnecessary_code_detected ? 'warning' : 'secondary'}">
                                    <i class="fas fa-${analysis.coding_analysis.unnecessary_code_detected ? 'code' : 'minus'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card detector-card border-${analysis.multilingual_analysis.is_multilingual ? 'info' : 'secondary'}">
                            <div class="card-body p-2">
                                <small class="fw-bold">ë‹¤êµ­ì–´</small>
                                <div class="text-${analysis.multilingual_analysis.is_multilingual ? 'info' : 'secondary'}">
                                    <i class="fas fa-${analysis.multilingual_analysis.is_multilingual ? 'globe' : 'minus'}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // ë§ì¥ë‚œ ê°ì§€ ì‹œ íŠ¹ë³„ í‘œì‹œ
        if (analysis.puns_analysis && analysis.puns_analysis.is_pun_detected) {
            resultHtml += `
                <div class="alert alert-success">
                    <i class="fas fa-smile me-2"></i>
                    <strong>ë§ì¥ë‚œ ê°ì§€!</strong> AIê°€ ì–¸ì–´ì  ìœ ë¨¸ë¥¼ ì´í•´í–ˆìŠµë‹ˆë‹¤! ğŸ˜„
                </div>
                <div class="mb-3">
                    <h6><i class="fas fa-lightbulb text-warning me-2"></i>ë§ì¥ë‚œ ë¶„ì„ ê²°ê³¼</h6>
                    <div class="alert alert-info">
                        <strong>ì´í•´ë„:</strong> ${(analysis.puns_analysis.pun_understanding * 100).toFixed(1)}%<br>
                        <strong>ê°ì§€ëœ ìœ í˜•:</strong> ${analysis.puns_analysis.pun_types.join(', ')}<br>
                        <strong>AI ì‘ë‹µ:</strong><br>
                        <em>${analysis.puns_analysis.pun_response.replace(/\n/g, '<br>')}</em>
                    </div>
                </div>
            `;
        } else if (analysis.multilingual_analysis && analysis.multilingual_analysis.is_multilingual) {
            resultHtml += `
                <div class="alert alert-info">
                    <i class="fas fa-globe me-2"></i>
                    <strong>ë‹¤êµ­ì–´ ë¬¸ì¥ ê°ì§€!</strong> ì—¬ëŸ¬ ì–¸ì–´ê°€ ì„ì¸ ë¬¸ì¥ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.
                </div>
                <div class="mb-3">
                    <h6><i class="fas fa-language text-info me-2"></i>ë‹¤êµ­ì–´ ë¶„ì„ ê²°ê³¼</h6>
                    <div class="alert alert-info">
                        <strong>ê°ì§€ëœ ì–¸ì–´:</strong> ${analysis.multilingual_analysis.detected_languages.join(', ')}<br>
                        <strong>ì´í•´ë„:</strong> ${(analysis.multilingual_analysis.understanding_score * 100).toFixed(1)}%<br>
                        <strong>ì–¸ì–´ ë¶„í¬:</strong><br>
                        ${Object.entries(analysis.multilingual_analysis.language_distribution).map(([lang, data]) => 
                            `â€¢ ${data.name}: ${data.char_count}ê°œ ë¬¸ì (${data.percentage.toFixed(1)}%)`
                        ).join('<br>')}<br>
                        <strong>AI ì‘ë‹µ:</strong><br>
                        <em>${analysis.multilingual_analysis.ai_response.replace(/\n/g, '<br>')}</em>
                    </div>
                </div>
            `;
        } else if (analysis.coding_analysis && analysis.coding_analysis.is_coding_analysis) {
            resultHtml += `
                <div class="alert alert-${analysis.coding_analysis.is_intentional_manipulation ? 'danger' : 'warning'}">
                    <i class="fas fa-code me-2"></i>
                    <strong>ì½”ë”© í’ˆì§ˆ ë¶„ì„!</strong> ${analysis.coding_analysis.is_intentional_manipulation ? 'ì˜ë„ì  ì¡°ì‘ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!' : 'ì½”ë”© í’ˆì§ˆì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.'}
                </div>
                <div class="mb-3">
                    <h6><i class="fas fa-chart-line text-primary me-2"></i>ì½”ë”© í’ˆì§ˆ ë¶„ì„ ê²°ê³¼</h6>
                    <div class="alert alert-${analysis.coding_analysis.is_intentional_manipulation ? 'danger' : 'info'}">
                        <strong>í’ˆì§ˆ ì ìˆ˜:</strong> ${(analysis.coding_analysis.quality_score * 100).toFixed(1)}%<br>
                        <strong>í’ˆì§ˆ ë“±ê¸‰:</strong> ${analysis.coding_analysis.quality_grade}<br>
                        <strong>ë¶ˆí•„ìš”í•œ ì½”ë“œ:</strong> ${analysis.coding_analysis.unnecessary_code_detected ? 'ê°ì§€ë¨' : 'ì—†ìŒ'}<br>
                        <strong>ì˜ë„ì  ì¡°ì‘:</strong> ${analysis.coding_analysis.is_intentional_manipulation ? 'ê°ì§€ë¨' : 'ì—†ìŒ'}<br>
                        <strong>AI ì‘ë‹µ:</strong><br>
                        <em>${analysis.coding_analysis.ai_response.replace(/\n/g, '<br>')}</em>
                    </div>
                </div>
            `;
        } else if (finalAnalysis.needs_correction) {
            resultHtml += `
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>ê±°ì§“ë§ ê°ì§€!</strong> êµì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
                </div>
            `;
            
            // êµì • ëŠ¥ë ¥ ê°•í™” ê²°ê³¼ í‘œì‹œ
            if (analysis.correction_enhancement.enhanced_correction_applied && analysis.correction_enhancement.corrected_statement) {
                resultHtml += `
                    <div class="mb-3">
                        <div class="alert alert-info">
                            <i class="fas fa-tools me-2"></i>
                            <strong>êµì • ëŠ¥ë ¥ ê°•í™” ì ìš©!</strong> AIê°€ ê±°ì§“ë§ì„ ê°ì§€í•˜ê³  êµì •í–ˆìŠµë‹ˆë‹¤.
                        </div>
                        <h6>ì›ë³¸ ë¬¸ì¥:</h6>
                        <div class="bg-danger bg-opacity-10 p-3 rounded mb-2">
                            <em class="text-danger">${analysis.statement}</em>
                        </div>
                        <h6>êµì •ëœ ë¬¸ì¥:</h6>
                        <div class="bg-success bg-opacity-10 p-3 rounded">
                            <em class="text-success">${analysis.correction_enhancement.corrected_statement}</em>
                        </div>
                    </div>
                `;
            }
            
            // ë§¥ë½ ì¸ì‹ ê²°ê³¼ í‘œì‹œ
            if (analysis.context_analysis && analysis.context_analysis.context_type !== 'unknown') {
                resultHtml += `
                    <div class="mb-3">
                        <h6><i class="fas fa-language text-primary me-2"></i>ë§¥ë½ ì¸ì‹ ê²°ê³¼</h6>
                        <div class="alert alert-info">
                            <strong>ë§¥ë½ ìœ í˜•:</strong> ${analysis.context_analysis.context_type}<br>
                            <strong>ì˜ë¯¸:</strong> ${analysis.context_analysis.contextual_meaning}<br>
                            ${analysis.context_analysis.context_warnings && analysis.context_analysis.context_warnings.length > 0 ? 
                                `<strong>ê²½ê³ :</strong> ${analysis.context_analysis.context_warnings[0]}` : ''}
                        </div>
                    </div>
                `;
            }
            
            // ë³µí•© ë¬¸ì¥ ë¶„ì„ ê²°ê³¼ í‘œì‹œ
            if (analysis.compound_analysis && analysis.compound_analysis.compound_type !== 'simple') {
                resultHtml += `
                    <div class="mb-3">
                        <h6><i class="fas fa-layer-group text-dark me-2"></i>ë³µí•© ë¬¸ì¥ ë¶„ì„ ê²°ê³¼</h6>
                        <div class="alert alert-secondary">
                            <strong>ë³µí•© ìœ í˜•:</strong> ${analysis.compound_analysis.compound_type}<br>
                            <strong>ë¶„ë¦¬ëœ ë¬¸ì¥ ìˆ˜:</strong> ${analysis.compound_analysis.sentence_count}ê°œ<br>
                            <strong>ë¶„ë¦¬ëœ ë¬¸ì¥ë“¤:</strong><br>
                            ${analysis.compound_analysis.sentences.map((sentence, index) => 
                                `<small class="text-muted">${index + 1}. ${sentence}</small><br>`
                            ).join('')}
                            ${analysis.compound_analysis.compound_warnings && analysis.compound_analysis.compound_warnings.length > 0 ? 
                                `<strong>ê²½ê³ :</strong> ${analysis.compound_analysis.compound_warnings[0]}` : ''}
                        </div>
                    </div>
                `;
            }
            
            // ê°ì§€ëœ ë¬¸ì œì ë“¤ í‘œì‹œ
            let allDetectedLies = [];
            if (analysis.basic_analysis.detected_lies) allDetectedLies = allDetectedLies.concat(analysis.basic_analysis.detected_lies);
            if (analysis.meta_analysis.meta_lies) allDetectedLies = allDetectedLies.concat(analysis.meta_analysis.meta_lies);
            if (analysis.scientific_analysis.detected_scientific_lies) allDetectedLies = allDetectedLies.concat(analysis.scientific_analysis.detected_scientific_lies);
            if (analysis.human_behavior_analysis.detected_human_behavior_lies) allDetectedLies = allDetectedLies.concat(analysis.human_behavior_analysis.detected_human_behavior_lies);
            
            if (allDetectedLies.length > 0) {
                resultHtml += `
                    <div class="mb-3">
                        <h6>ê°ì§€ëœ ë¬¸ì œì :</h6>
                        <ul class="list-unstyled">
                            ${allDetectedLies.map(lie => `<li><i class="fas fa-times text-danger me-2"></i>${lie}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // êµì • ì œì•ˆ í‘œì‹œ
            if (analysis.basic_analysis.correction_suggestions && analysis.basic_analysis.correction_suggestions.length > 0) {
                resultHtml += `
                    <div class="mb-3">
                        <h6>êµì • ì œì•ˆ:</h6>
                        <ul class="list-unstyled">
                            ${analysis.basic_analysis.correction_suggestions.map(suggestion => `<li><i class="fas fa-lightbulb text-warning me-2"></i>${suggestion}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
        } else {
            resultHtml += `
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>ì§„ì‹¤ì„± í™•ì¸!</strong> ì´ ë¬¸ì¥ì€ ì‹ ë¢°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }
        
        // ì² í•™ì  ë…¸íŠ¸ í‘œì‹œ
        let philosophicalNotes = [];
        if (analysis.meta_analysis.philosophical_note) philosophicalNotes.push(analysis.meta_analysis.philosophical_note);
        if (analysis.religious_analysis.philosophical_note) philosophicalNotes.push(analysis.religious_analysis.philosophical_note);
        if (analysis.scientific_analysis.philosophical_note) philosophicalNotes.push(analysis.scientific_analysis.philosophical_note);
        if (analysis.intentional_analysis.philosophical_note) philosophicalNotes.push(analysis.intentional_analysis.philosophical_note);
        
        if (philosophicalNotes.length > 0) {
            resultHtml += `
                <div class="mb-3">
                    <h6>ì² í•™ì  ê´€ì :</h6>
                    <div class="bg-light p-3 rounded">
                        ${philosophicalNotes.map(note => `<p class="mb-1"><em>${note}</em></p>`).join('')}
                    </div>
                </div>
            `;
        }
        
        resultDiv.innerHTML = resultHtml;
    }
    
    // ìµœê·¼ ë¶„ì„ ê²°ê³¼ ë¡œë“œ
    async function loadRecentAnalyses() {
        try {
            const response = await fetch('/api/recent_analyses');
            const analyses = await response.json();
            
            if (analyses.length === 0) {
                recentDiv.innerHTML = `
                    <div class="text-center text-muted">
                        <i class="fas fa-clock fa-2x mb-2"></i>
                        <p>ì•„ì§ ë¶„ì„ëœ ë¬¸ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            analyses.forEach(analysis => {
                const finalAnalysis = analysis.final_analysis || analysis;
                const truthPercentage = (finalAnalysis.truth_percentage * 100).toFixed(1);
                const timestamp = new Date(analysis.timestamp).toLocaleString('ko-KR');
                
                // íƒì§€ê¸°ë³„ ì•„ì´ì½˜ ìƒì„±
                let detectorIcons = '';
                if (analysis.meta_analysis && analysis.meta_analysis.meta_lie_detected) detectorIcons += '<i class="fas fa-mirror text-danger me-1" title="ë©”íƒ€-ì§„ì‹¤ì„±"></i>';
                if (analysis.religious_analysis && analysis.religious_analysis.religious_topic_detected) detectorIcons += '<i class="fas fa-cross text-warning me-1" title="ì¢…êµì  ë§¥ë½"></i>';
                if (analysis.scientific_analysis && analysis.scientific_analysis.scientific_lie_detected) detectorIcons += '<i class="fas fa-flask text-danger me-1" title="ê³¼í•™ì  ê²€ì¦"></i>';
                if (analysis.intentional_analysis && analysis.intentional_analysis.intentional_lie_detected) detectorIcons += '<i class="fas fa-brain text-warning me-1" title="ì˜ë„ì  ê±°ì§“ë§"></i>';
                if (analysis.human_behavior_analysis && analysis.human_behavior_analysis.is_human_behavior_lie) detectorIcons += '<i class="fas fa-user-times text-danger me-1" title="ì¸ê°„ í–‰ë™"></i>';
                if (analysis.benevolent_analysis && analysis.benevolent_analysis.is_benevolent_lie) detectorIcons += '<i class="fas fa-heart text-info me-1" title="ì„ ì˜ì˜ ê±°ì§“ë§"></i>';
                if (analysis.correction_enhancement && analysis.correction_enhancement.enhanced_correction_applied) detectorIcons += '<i class="fas fa-tools text-success me-1" title="êµì • ê°•í™”"></i>';
                if (analysis.context_analysis && analysis.context_analysis.context_correction_applied) detectorIcons += '<i class="fas fa-language text-primary me-1" title="ë§¥ë½ ì¸ì‹"></i>';
                if (analysis.compound_analysis && analysis.compound_analysis.compound_correction_applied) detectorIcons += '<i class="fas fa-layer-group text-dark me-1" title="ë³µí•© ë¬¸ì¥"></i>';
                if (analysis.puns_analysis && analysis.puns_analysis.is_pun_detected) detectorIcons += '<i class="fas fa-smile text-success me-1" title="ë§ì¥ë‚œ"></i>';
                if (analysis.coding_analysis && analysis.coding_analysis.unnecessary_code_detected) detectorIcons += '<i class="fas fa-code text-warning me-1" title="ì½”ë”© í’ˆì§ˆ"></i>';
                if (analysis.multilingual_analysis && analysis.multilingual_analysis.is_multilingual) detectorIcons += '<i class="fas fa-globe text-info me-1" title="ë‹¤êµ­ì–´"></i>';
                
                html += `
                    <div class="border-bottom pb-3 mb-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="badge bg-${truthPercentage >= 99 ? 'success' : truthPercentage >= 70 ? 'warning' : 'danger'} me-2">
                                    ${truthPercentage}%
                                </span>
                                ${detectorIcons}
                            </div>
                            <small class="text-muted">${timestamp}</small>
                        </div>
                        <p class="mb-1">${analysis.statement}</p>
                        ${finalAnalysis.needs_correction ? '<small class="text-warning"><i class="fas fa-exclamation-triangle me-1"></i>êµì • í•„ìš”</small>' : '<small class="text-success"><i class="fas fa-check me-1"></i>ì§„ì‹¤ì„± í™•ì¸</small>'}
                    </div>
                `;
            });
            
            recentDiv.innerHTML = html;
        } catch (error) {
            console.error('ìµœê·¼ ë¶„ì„ ê²°ê³¼ ë¡œë“œ ì‹¤íŒ¨:', error);
        }
    }
    
    // AI ìì²´ ë¶„ì„ ê²°ê³¼ í‘œì‹œ
    function displayAISelfAnalysisResult(analysis) {
        const aiSelfAnalysis = analysis.ai_self_analysis;
        const realTimeAnalysis = analysis.real_time_analysis;
        const metaSystemAnalysis = analysis.meta_system_analysis;
        const finalAnalysis = analysis.final_analysis;
        
        const truthPercentage = (finalAnalysis.truth_percentage * 100).toFixed(1);
        const confidence = (finalAnalysis.confidence * 100).toFixed(1);
        
        let resultHtml = `
            <div class="alert alert-info">
                <i class="fas fa-robot me-2"></i>
                <strong>AI ìì²´ ì§„ì‹¤ì„± ë¶„ì„!</strong> AIê°€ ìŠ¤ìŠ¤ë¡œ ìì‹ ì˜ ì¶œë ¥ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.
            </div>
            
            <div class="mb-3">
                <h6>ğŸ¤– AI ìì²´ ë¶„ì„ ê²°ê³¼</h6>
                <div class="truth-meter mb-2">
                    <div class="truth-indicator" style="width: ${truthPercentage}%"></div>
                </div>
                <div class="d-flex justify-content-between">
                    <span class="badge bg-${truthPercentage >= 99 ? 'success' : truthPercentage >= 70 ? 'warning' : 'danger'} fs-6">
                        ${truthPercentage}%
                    </span>
                    <small class="text-muted">ì‹ ë¢°ë„: ${confidence}%</small>
                </div>
            </div>
        `;
        
        // AI ìì²´ ë¶„ì„ ìƒì„¸ ê²°ê³¼
        resultHtml += `
            <div class="mb-3">
                <h6><i class="fas fa-mirror text-primary me-2"></i>AI ìê¸° ì„±ì°°</h6>
                <div class="alert alert-light">
                    <strong>ì§„ì‹¤ì„± ìˆ˜ì¤€:</strong> ${aiSelfAnalysis.truth_level}<br>
                    <strong>ê°ì§€ëœ ê±°ì§“ë§:</strong> ${aiSelfAnalysis.detected_lies.length}ê°œ<br>
                    <strong>AI ìê¸° ì„±ì°°:</strong><br>
                    <em>${aiSelfAnalysis.self_reflection}</em>
                </div>
            </div>
        `;
        
        // ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ê²°ê³¼
        if (realTimeAnalysis.needs_correction) {
            resultHtml += `
                <div class="mb-3">
                    <h6><i class="fas fa-clock text-warning me-2"></i>ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ê²°ê³¼</h6>
                    <div class="alert alert-warning">
                        <strong>ìë™ êµì • ì ìš©!</strong> ${realTimeAnalysis.correction_reason}<br>
                        <strong>ì›ë³¸:</strong> ${realTimeAnalysis.statement}<br>
                        <strong>êµì •:</strong> ${realTimeAnalysis.corrected_statement}
                    </div>
                </div>
            `;
        }
        
        // ë©”íƒ€ ì‹œìŠ¤í…œ ë¶„ì„ ê²°ê³¼
        resultHtml += `
            <div class="mb-3">
                <h6><i class="fas fa-brain text-dark me-2"></i>ë©”íƒ€-ì¸ì§€ ë¶„ì„</h6>
                <div class="alert alert-secondary">
                    <strong>ìê¸° ì¸ì‹ ìˆ˜ì¤€:</strong> ${(metaSystemAnalysis.confidence_score * 100).toFixed(1)}%<br>
                    <strong>ê°ì§€ëœ ë¬¸ì œ:</strong> ${metaSystemAnalysis.detected_issues.length}ê°œ<br>
                    <strong>êµì • ì ìš©:</strong> ${metaSystemAnalysis.correction_applied ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}<br>
                    <strong>AI ìê¸° ì„±ì°°:</strong><br>
                    <em>${metaSystemAnalysis.self_reflection}</em>
                </div>
            </div>
        `;
        
        // ê°ì§€ëœ ë¬¸ì œì ë“¤ í‘œì‹œ
        if (aiSelfAnalysis.detected_lies.length > 0) {
            resultHtml += `
                <div class="mb-3">
                    <h6>ğŸ” AIê°€ ê°ì§€í•œ ê±°ì§“ë§ íŒ¨í„´:</h6>
                    <ul class="list-unstyled">
                        ${aiSelfAnalysis.detected_lies.map(lie => `<li><i class="fas fa-times text-danger me-2"></i>${lie}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        // êµì • ì œì•ˆ í‘œì‹œ
        if (aiSelfAnalysis.correction_suggestions.length > 0) {
            resultHtml += `
                <div class="mb-3">
                    <h6>ğŸ’¡ AIì˜ êµì • ì œì•ˆ:</h6>
                    <ul class="list-unstyled">
                        ${aiSelfAnalysis.correction_suggestions.map(suggestion => `<li><i class="fas fa-lightbulb text-warning me-2"></i>${suggestion}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        // êµì •ëœ ë¬¸ì¥ í‘œì‹œ
        if (aiSelfAnalysis.corrected_statement && aiSelfAnalysis.corrected_statement !== aiSelfAnalysis.original_statement) {
            resultHtml += `
                <div class="mb-3">
                    <h6>ğŸ“ AI ìì²´ êµì • ê²°ê³¼:</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-danger">ì›ë³¸ ë¬¸ì¥:</h6>
                            <div class="bg-danger bg-opacity-10 p-3 rounded">
                                <em>${aiSelfAnalysis.original_statement}</em>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-success">êµì •ëœ ë¬¸ì¥:</h6>
                            <div class="bg-success bg-opacity-10 p-3 rounded">
                                <em>${aiSelfAnalysis.corrected_statement}</em>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ì²˜ë¦¬ ì‹œê°„ í‘œì‹œ
        resultHtml += `
            <div class="mb-3">
                <h6>â±ï¸ ë¶„ì„ ì„±ëŠ¥</h6>
                <div class="row text-center">
                    <div class="col-4">
                        <small class="text-muted">AI ìì²´ ë¶„ì„</small><br>
                        <strong>${aiSelfAnalysis.processing_time.toFixed(3)}ì´ˆ</strong>
                    </div>
                    <div class="col-4">
                        <small class="text-muted">ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</small><br>
                        <strong>${realTimeAnalysis.processing_time.toFixed(3)}ì´ˆ</strong>
                    </div>
                    <div class="col-4">
                        <small class="text-muted">ë©”íƒ€ ì‹œìŠ¤í…œ</small><br>
                        <strong>${metaSystemAnalysis.processing_time.toFixed(3)}ì´ˆ</strong>
                    </div>
                </div>
            </div>
        `;
        
        // ìµœì¢… ìƒíƒœ í‘œì‹œ
        if (finalAnalysis.needs_correction) {
            resultHtml += `
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>AIê°€ ê±°ì§“ë§ì„ ê°ì§€í–ˆìŠµë‹ˆë‹¤!</strong> ìë™ìœ¼ë¡œ êµì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        } else {
            resultHtml += `
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>AIê°€ ì§„ì‹¤ì„±ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤!</strong> ì´ ë¬¸ì¥ì€ ì‹ ë¢°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }
        
        document.getElementById('analysisResult').innerHTML = resultHtml;
    }
    
    // ì›¹ ì—°êµ¬ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
    function displayResearchResult(result) {
        const resultDiv = document.getElementById('analysisResult');
        
        // í–¥ìƒëœ ì›¹ ì—°êµ¬ì¸ì§€ í™•ì¸
        const isEnhanced = result.search_progress && result.search_progress.length > 0;
        
        let html = `
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-search me-2"></i>${isEnhanced ? 'í–¥ìƒëœ ì›¹ ì—°êµ¬ ê²°ê³¼' : 'ì›¹ ì—°êµ¬ ê²°ê³¼'}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12">
                            <h6><i class="fas fa-question-circle me-2"></i>ì§ˆë¬¸</h6>
                            <p class="border p-3 bg-light rounded">${result.question}</p>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <h6><i class="fas fa-lightbulb me-2"></i>ë‹µë³€</h6>
                            <div class="border p-3 bg-success text-white rounded">
                                <pre style="white-space: pre-wrap; margin: 0;">${result.answer}</pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h6><i class="fas fa-tachometer-alt me-2"></i>ì‹ ë¢°ë„</h6>
                            <div class="progress mb-3" style="height: 25px;">
                                <div class="progress-bar ${result.confidence >= 0.8 ? 'bg-success' : result.confidence >= 0.6 ? 'bg-warning' : 'bg-danger'}" 
                                     style="width: ${result.confidence * 100}%">
                                    ${(result.confidence * 100).toFixed(1)}%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-database me-2"></i>ì°¸ê³  ì†ŒìŠ¤</h6>
                            <span class="badge bg-info fs-6">${result.sources.length}ê°œ</span>
                        </div>
                    </div>
                    
                    ${isEnhanced ? `
                        <div class="row">
                            <div class="col-md-12">
                                <h6><i class="fas fa-cogs me-2"></i>ê²€ìƒ‰ ì§„í–‰ ê³¼ì •</h6>
                                <div class="card">
                                    <div class="card-body">
                                        <div class="timeline">
                                            ${result.search_progress.map((progress, index) => `
                                                <div class="timeline-item">
                                                    <div class="timeline-marker bg-${progress.status === 'completed' ? 'success' : progress.status === 'failed' ? 'danger' : progress.status === 'in_progress' ? 'warning' : 'primary'}"></div>
                                                    <div class="timeline-content">
                                                        <h6 class="timeline-title">
                                                            <i class="fas fa-${progress.status === 'completed' ? 'check-circle' : progress.status === 'failed' ? 'times-circle' : progress.status === 'in_progress' ? 'clock' : 'play-circle'} me-2"></i>
                                                            ${progress.step}
                                                        </h6>
                                                        <p class="timeline-description">${progress.description}</p>
                                                        ${progress.details ? `<small class="text-muted">${progress.details}</small>` : ''}
                                                        <div class="progress mt-2" style="height: 4px;">
                                                            <div class="progress-bar bg-${progress.status === 'completed' ? 'success' : progress.status === 'failed' ? 'danger' : 'warning'}" 
                                                                 style="width: ${progress.progress_percentage}%"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="row">
                        <div class="col-md-12">
                            <h6><i class="fas fa-book me-2"></i>ì°¸ê³  ì†ŒìŠ¤</h6>
                            <div class="row">
                                ${result.sources.map((source, index) => `
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title">${source.title}</h6>
                                                <p class="card-text">${source.snippet}</p>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <small class="text-muted">${source.domain}</small>
                                                    <div>
                                                        <span class="badge bg-${source.credibility_score >= 0.8 ? 'success' : source.credibility_score >= 0.6 ? 'warning' : 'danger'}">
                                                            ì‹ ë¢°ë„: ${(source.credibility_score * 100).toFixed(0)}%
                                                        </span>
                                                    </div>
                                                </div>
                                                ${source.search_engine ? `<small class="text-info">ê²€ìƒ‰ ì—”ì§„: ${source.search_engine}</small><br>` : ''}
                                                ${source.search_keyword ? `<small class="text-secondary">í‚¤ì›Œë“œ: ${source.search_keyword}</small><br>` : ''}
                                                ${source.processing_time ? `<small class="text-muted">ì²˜ë¦¬ ì‹œê°„: ${source.processing_time.toFixed(2)}ì´ˆ</small><br>` : ''}
                                                <a href="${source.url}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">
                                                    <i class="fas fa-external-link-alt me-1"></i>ì›ë¬¸ ë³´ê¸°
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    ${result.fact_checks && result.fact_checks.length > 0 ? `
                        <div class="row">
                            <div class="col-md-12">
                                <h6><i class="fas fa-check-double me-2"></i>ì‚¬ì‹¤ ê²€ì¦</h6>
                                <div class="row">
                                    ${result.fact_checks.map((check, index) => `
                                        <div class="col-md-6 mb-2">
                                            <div class="card ${check.is_factual ? 'border-success' : 'border-danger'}">
                                                <div class="card-body">
                                                    <h6 class="card-title">
                                                        <i class="fas fa-${check.is_factual ? 'check-circle text-success' : 'times-circle text-danger'} me-2"></i>
                                                        ${check.is_factual ? 'ê²€ì¦ë¨' : 'ê²€ì¦ ì‹¤íŒ¨'}
                                                    </h6>
                                                    <p class="card-text">${check.statement}</p>
                                                    <small class="text-muted">ì‹ ë¢°ë„: ${(check.confidence * 100).toFixed(0)}%</small>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <h6><i class="fas fa-brain me-2"></i>ì¶”ë¡  ê³¼ì •</h6>
                            <p class="border p-3 bg-light rounded">${result.reasoning}</p>
                        </div>
                    </div>
                    
                    ${result.limitations && result.limitations.length > 0 ? `
                        <div class="row">
                            <div class="col-md-12">
                                <h6><i class="fas fa-exclamation-triangle me-2"></i>í•œê³„ì </h6>
                                <ul class="list-group">
                                    ${result.limitations.map(limitation => `
                                        <li class="list-group-item">${limitation}</li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                ì—°êµ¬ ì‹œê°„: ${new Date(result.timestamp).toLocaleString('ko-KR')}
                                ${result.total_processing_time ? ` | ì´ ì²˜ë¦¬ ì‹œê°„: ${result.total_processing_time.toFixed(2)}ì´ˆ` : ''}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        resultDiv.innerHTML = html;
    }
    
    // ì‚¬ì‹¤ ê²€ì¦ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
    function displayVerificationResult(result) {
        const resultDiv = document.getElementById('analysisResult');
        
        let html = `
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-check-double me-2"></i>ì‚¬ì‹¤ ê²€ì¦ ê²°ê³¼</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12">
                            <h6><i class="fas fa-quote-left me-2"></i>ê²€ì¦ ëŒ€ìƒ ë¬¸ì¥</h6>
                            <p class="border p-3 bg-light rounded">${result.statement}</p>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-check-circle me-2"></i>ê²€ì¦ ê²°ê³¼</h6>
                            <div class="text-center">
                                <i class="fas fa-${result.is_verified ? 'check-circle text-success' : 'times-circle text-danger'} fa-3x mb-3"></i>
                                <h4 class="${result.is_verified ? 'text-success' : 'text-danger'}">
                                    ${result.is_verified ? 'ì‚¬ì‹¤ë¡œ í™•ì¸ë¨' : 'ì‚¬ì‹¤ì´ ì•„ë‹ ê°€ëŠ¥ì„±'}
                                </h4>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-tachometer-alt me-2"></i>ì‹ ë¢°ë„</h6>
                            <div class="progress mb-3" style="height: 25px;">
                                <div class="progress-bar ${result.confidence >= 0.8 ? 'bg-success' : result.confidence >= 0.6 ? 'bg-warning' : 'bg-danger'}" 
                                     style="width: ${result.confidence * 100}%">
                                    ${(result.confidence * 100).toFixed(1)}%
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    ${result.evidence && result.evidence.length > 0 ? `
                        <div class="row">
                            <div class="col-md-12">
                                <h6><i class="fas fa-search me-2"></i>ì¦ê±°</h6>
                                <ul class="list-group">
                                    ${result.evidence.map(evidence => `
                                        <li class="list-group-item">${evidence}</li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="row">
                        <div class="col-md-12">
                            <h6><i class="fas fa-book me-2"></i>ì°¸ê³  ì†ŒìŠ¤</h6>
                            <div class="row">
                                ${result.sources.map((source, index) => `
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title">${source.title}</h6>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <small class="text-muted">${source.url}</small>
                                                    <span class="badge bg-${source.credibility_score >= 0.8 ? 'success' : source.credibility_score >= 0.6 ? 'warning' : 'danger'}">
                                                        ì‹ ë¢°ë„: ${(source.credibility_score * 100).toFixed(0)}%
                                                    </span>
                                                </div>
                                                <a href="${source.url}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">
                                                    <i class="fas fa-external-link-alt me-1"></i>ì›ë¬¸ ë³´ê¸°
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <h6><i class="fas fa-brain me-2"></i>ê²€ì¦ ê³¼ì •</h6>
                            <p class="border p-3 bg-light rounded">${result.reasoning}</p>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                ê²€ì¦ ì‹œê°„: ${new Date(result.timestamp).toLocaleString('ko-KR')}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        resultDiv.innerHTML = html;
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìµœê·¼ ë¶„ì„ ê²°ê³¼ ë¡œë“œ
    loadRecentAnalyses();
});
</script>
{% endblock %}
